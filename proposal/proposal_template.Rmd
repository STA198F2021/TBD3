---
title: "Project Proposal"
subtitle: "due October 11, 2021 by 11:59 PM "
author: "Grace Lee and Ji Yun Hyo, TBD3"
date: "October 11th, 2021"
output: pdf_document
fontsize: 11 pt
---

# Load Packages

```{r load-packages, message = FALSE, warning = FALSE}
library(dplyr)
library(tidyverse)
library(sf)
library(viridis)
library(tidyverse)
library(tidymodels)
library(ggspatial) #for scale annotation
``` 

# Load Data
```{r load-data, message = F, warning = FALSE}
data <- read.csv(file = '../data/COVID_raw_12.8.csv')
tidy_data <- select(data, c('Participant_ID', 'age',"usres", "state", "race", "sex", "localsip", "localsip2", "localsip3", "leavehomeact___1", "leavehomeact___2", "leavehomeact___3", "leavehomeact___4", "leavehomeact___5", "leavehomeact___6", "leavehomeact___7", "leavehomereason___1", "leavehomereason___2", "leavehomereason___3", "leavehomereason___4", "leavehomereason___5", "leavehomereason___6", "leavehomereason___7", "localsiphours", "covidsick", "hhcovidsick", "ffcovidsick", "Classification", "covidtest", "educ", "hhincome"))

tidy_data <- tidy_data %>%
  filter(is.na(tidy_data$race)== FALSE & is.na(tidy_data$localsiphours)== FALSE)
```

# Introduction and Data, including Research Questions
In response to the COVID-19 pandemic, 42 states and territories issued mandatory stay-at-home orders between March 1 to May 31, 2020 (CDC, 2020). These stay-at-home policies reduced both population movement and person-to-person contact, which slowed the spread of COVID-19. In a study published by Cambridge University Press in May 2020, the total number of infections was projected to reach 287 million in the absence of stay-at-home and social distancing policies and 188 million with the enforcement of these policies, translating to 1.24 million lives saved (Thunström et al., 2020).  
 
Due to the importance of stay-at-home orders in slowing the spread of COVID in the United States, we want to ask if the average number of hours spent at home differed between different populations. For example, we want to ask if people of different races and income levels, among other variables, differed significantly in their mean number of hours spent at home. To do so, we used the dataset, “Associations of Urbanicity and Sociodemographic Characteristics with Protective Health Behaviors and Reasons for Leaving the Home during COVID-19,” found on the Harvard Dataverse. The data was collected through an online questionnaire of U.S. adults (N = 2,441) recruited through social media platforms such as Twitter, Instagram, and Facebook. The dataset had 66 variables corresponding to the questionnaire questions. We chose to focus on the survey responses pertaining to (1) age, (2) country & (3) state of residence, (4) race, (5) sex, (6) if local stay-at-home orders existed, (7) if the participant stayed home even if no order existed or (8) even if they didn’t know if an order existed, (9) how the participant protected themselves in public, (10) reasons for leaving home during the order, (11) average hours per day spent at home during the pandemic, (12) if the participant had contracted COVID, (13) if anyone in the household had contracted COVID, (14) if any close friends had contracted COVID, (15) if the participant lived in an urban, suburban, or rural area, (16) whether the participant had been tested for COVID, (17) educational attainment, and (18) annual income. Each participant/observation was identified by a unique participant ID. 

# Glimpse

```{r glimpse, warning = FALSE}
glimpse(tidy_data)
```

# Data Analysis Plan
In order to explore the relationships between certain demographic characteristics and hours stayed at home during the pandemic, we will conduct multiple two-sample t-tests comparing the mean number of hours spent at home during the pandemic between different races (e.g. Asian vs. White), levels of education, and income levels, among others. We also plan on constructing 95% confidence intervals regarding the number of hours spent at home for populations with and without formal stay-at-home orders. In addition, we plan on visualizing the most frequently cited methods of protection from COVID used when in public as well as reasons for leaving home during a stay-in-place order. 

At present, we hypothesize that Asian people will differ in their mean hours spent at home compared to white people, as they had 0.7 times the hospitalization rate of white people (CDC, 2020). We also hypothesize that people with incomes over $150,000 will have different/greater average hours spent at home due to essential workers, whose incomes are lower on average, being required to leave home for work. To achieve these results, we would need significant p-values of under 0.05 from our t-tests. The 95% confidence intervals for mean hours spent at home should also completely overlap infrequently. The table and graph below give us a preliminary idea of the differences in average hours spent home among different populations such as urban vs. rural and between different races. 

References: 
Centers for Disease Control and Prevention. (2020, September 3). Timing of state and territorial COVID-19 stay-at-home orders and changes in population movement - United States, March 1–May 31, 2020. Centers for Disease Control and Prevention. 

Thunström, L., Newbold, S. C., Finnoff, D., Ashworth, M., &amp; Shogren, J. F. (2020, May 21). The benefits and costs of using social distancing to flatten the curve for covid-19: Journal of Benefit-Cost Analysis. Cambridge. 

```{r summmarize-hours, warning = FALSE}
number_of_hours <- tidy_data %>%
  group_by(race) %>%
  summarise_at(vars(localsiphours), list(hours = mean),na.rm = TRUE) #to summarize count

number_of_hours_two <- tidy_data %>%
  group_by(Classification) %>%
  summarise_at(vars(localsiphours), list(hours = mean),na.rm = TRUE) %>% #to summarize count
  print()
```

```{r data-analysis, fig.width = 9, fig.height= 2.5}
tidy_data$Classification[is.na(tidy_data$Classification)== TRUE] <- "Urban"
number_of_hours$race[number_of_hours$race == 0] <- "American Indian"
number_of_hours$race[number_of_hours$race == 1] <- "Asian"
number_of_hours$race[number_of_hours$race == 2] <- "Native Hawaiian"
number_of_hours$race[number_of_hours$race == 3] <- "African American"
number_of_hours$race[number_of_hours$race == 4] <- "White"
number_of_hours$race[number_of_hours$race == 5] <- "Mixed"
number_of_hours$race[number_of_hours$race == 6] <- "Unknown"

ggplot(data=number_of_hours, aes(x=race, y=hours)) +
  geom_bar(stat="identity") +
  labs (
    y = "Average Hours Remained at Home",
    x = "Race",
    title = "Number of Hours Remained at Home by Race",
    ) 
```
```{r t-test}
tidy_data <- tidy_data %>%
  mutate(asian = ifelse(race == 1, 1, 0)) %>%
  mutate(white = ifelse(race == 4, 1, 0)) %>%
  mutate(unknown = ifelse(race == 6, 1, 0)) %>%
  mutate(africanamerican = ifelse(race == 3, 1, 0)) %>%
  mutate(americanindian = ifelse(race == 0, 1, 0)) %>%
  mutate(mixed = ifelse(race == 5, 1, 0)) %>%
  mutate(hawaiian = ifelse(race == 2, 1, 0)) 
  
# t-test insignificant p-value (do not reject null hypothesis)
t.test(tidy_data$localsiphours~tidy_data$asian, var.equal=FALSE)
t.test(tidy_data$localsiphours~tidy_data$white, var.equal=FALSE)
t.test(tidy_data$localsiphours~tidy_data$africanamerican, var.equal=FALSE)
t.test(tidy_data$localsiphours~tidy_data$americanindian, var.equal=FALSE)
t.test(tidy_data$localsiphours~tidy_data$mixed, var.equal=FALSE)
t.test(tidy_data$localsiphours~tidy_data$hawaiian, var.equal=FALSE)

# t-test significant p-value (reject null hypothesis)
t.test(tidy_data$localsiphours~tidy_data$unknown, var.equal=FALSE)
t.test(tidy_data$localsiphours~tidy_data$sex, var.equal=FALSE)

# ANOVA with UNKOWN
summary(aov(localsiphours~race,data=tidy_data))
summary(aov(localsiphours~state,data=tidy_data))

# filter out unkonwn and observe results
tidy_data_without_unknown <- tidy_data %>%
  filter(unknown ==0)

# ANOVA test
summary(aov(localsiphours~race,data=tidy_data_without_unknown))
```

```{r regression}
#fit logistic regression model
localsiphours_fit <- linear_reg() %>%
  set_engine("lm") %>%
  fit(localsiphours ~ asian + white + africanamerican + americanindian + mixed + hawaiian, data = tidy_data)

tidy(localsiphours_fit, conf.int=TRUE, exponentiate = TRUE)
```